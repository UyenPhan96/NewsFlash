@model List<Web_News.Areas.Admin.ViewModels.UserViewModels>

@{
    ViewBag.title ="Danh Sách User - "+ ViewBag.CurrentStatus;
    var returnUrl = Context.Request.Path + Context.Request.QueryString;
}

<div>
    <a href="@Url.Action("ManageUsers", new { status = "active" })" class="btn @((ViewBag.CurrentStatus == "active") ? "btn-danger" : "btn-secondary")">Tài khoản hoạt động</a>
    <a href="@Url.Action("ManageUsers", new { status = "locked" })" class="btn @((ViewBag.CurrentStatus == "locked") ? "btn-danger" : "btn-secondary")">Tài khoản bị khóa</a>
    <a href="@Url.Action("ManageUsers", new { status = "deleted" })" class="btn @((ViewBag.CurrentStatus == "deleted") ? "btn-danger" : "btn-secondary")">Tài khoản đã xóa</a>
</div>

<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <h4>Danh sách người dùng</h4>
            <hr />
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Tên người dùng</th>
                        <th>Email</th>
                        <th>Địa chỉ</th>
                        <th>SĐT</th>
                        <th>Tên tài khoản</th>
                        <th>Vai trò</th>
                        <th>Ngày đăng ký</th>
                        <th>Trạng thái tài khoản</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var user in Model)
                    {
                        <tr>
                            <td>@user.Name</td>
                            <td>@user.Email</td>
                            <td>@user.Address</td>
                            <td>@user.Phone</td>
                            <td>@user.UserName</td>
                            <td>@user.Role</td>
                            <td>@user.RegistrationDate.ToString("dd/MM/yyyy")</td>
                            <td>
                                <span class="badge @(user.AccountStatus ? "bg-danger" : "bg-success")">
                                    @(user.AccountStatus ? "Đã khóa" : "Hoạt động")
                                </span>
                            </td>
                            <td>
                                @if (ViewBag.CurrentStatus == "active")
                                {
                                    <!-- Form xóa -->
                                    <form method="post" action="@Url.Action("DeleteUser", new { userId = user.UserId, returnUrl = returnUrl })" id="deleteForm-@user.UserId" style="display:none;">
                                        <input type="hidden" name="userId" value="@user.UserId" />
                                    </form>

                                    <button type="button" class="btn btn-outline-warning btn-sm" onclick="showDeleteAlert('@user.UserId')">
                                        <i class="mdi mdi-delete"></i> Xóa
                                    </button>

                                    <!-- Form khóa tài khoản -->
                                    <form method="post" action="@Url.Action("AccountStatus", new { userId = user.UserId, status = "locked", returnUrl = returnUrl })" id="lockForm-@user.UserId" style="display:none;">
                                    </form>
                                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="showLockAlert('@user.UserId')">
                                        <i class="mdi mdi-lock"></i> Khóa
                                    </button>
                                }
                                else if (ViewBag.CurrentStatus == "locked")
                                {
                                    <!-- Form mở khóa tài khoản -->
                                    <form method="post" action="@Url.Action("AccountStatus", new { userId = user.UserId, status = "active", returnUrl = returnUrl })" id="unlockForm-@user.UserId" style="display:none;">
                                    </form>
                                    <button type="button" class="btn btn-outline-success btn-sm" onclick="showUnlockAlert('@user.UserId')">
                                        <i class="mdi mdi-lock-open"></i> Mở khóa
                                    </button>

                                    <!-- Form xóa -->
                                    <form method="post" action="@Url.Action("DeleteUser", new { userId = user.UserId, returnUrl = returnUrl })" id="deleteForm-@user.UserId" style="display:none;">
                                        <input type="hidden" name="userId" value="@user.UserId" />
                                    </form>
                                    <button type="button" class="btn btn-outline-warning btn-sm" onclick="showDeleteAlert('@user.UserId')">
                                        <i class="mdi mdi-delete"></i> Xóa
                                    </button>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
      function showDeleteAlert(userId) {
        Swal.fire({
            title: 'Bạn có chắc chắn muốn xóa tài khoản này?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Xóa',
            cancelButtonText: 'Hủy',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                // Tìm và submit form xóa
                document.getElementById('deleteForm-' + userId).submit();
            }
        });
    }

    function showLockAlert(userId) {
        Swal.fire({
            title: 'Bạn có chắc chắn muốn khóa tài khoản này?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Khóa',
            cancelButtonText: 'Hủy',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById('lockForm-' + userId).submit();
            }
        });
    }

    function showUnlockAlert(userId) {
        Swal.fire({
            title: 'Bạn có chắc chắn muốn mở khóa tài khoản này?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Mở khóa',
            cancelButtonText: 'Hủy',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById('unlockForm-' + userId).submit();
            }
        });
    }

</script>